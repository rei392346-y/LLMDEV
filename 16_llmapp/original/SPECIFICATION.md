# チャットボットアプリケーション仕様書

## 1. システム概要

このアプリケーションは、OpenAIのGPTモデルを利用した高度なチャットボットシステムです。PDFドキュメントの検索機能とWeb検索機能を組み合わせた、インテリジェントな応答が可能なチャットボットを実装しています。

## 2. 主要機能

### 2.1 チャット機能
- ユーザーとチャットボット間でのインタラクティブな対話
- セッションごとの対話履歴の保持
- マルチユーザー対応（セッション管理による個別の対話管理）
- 対話履歴のクリア機能

### 2.2 カスタマイズ機能
- チャットボットのキャラクター設定機能
  - 名前の設定
  - 説明文の設定
  - システムプロンプトの設定

### 2.3 検索・情報取得機能
- PDFドキュメントからの情報検索機能
- Tavilyを利用したWeb検索機能
- 複数のツールを組み合わせた高度な応答生成

## 3. 技術仕様

### 3.1 使用技術
- フレームワーク: Flask
- 言語モデル: GPT-4-mini
- エンベッディングモデル: text-embedding-3-small
- データベース: Chroma (ベクトルデータベース)
- 検索エンジン: Tavily Search API

### 3.2 主要コンポーネント

#### 3.2.1 グラフシステム（graph.py）
- StateGraphを利用した対話フロー管理
- ツールノードとチャットボットノードの連携
- メモリ管理システム（MemorySaver）による状態保持

#### 3.2.2 Webアプリケーション（app.py）
- Flaskによるルーティング管理
- セッション管理
- テンプレートレンダリング

### 3.3 データフロー
1. ユーザーからの入力受付
2. セッションIDによる対話コンテキスト管理
3. グラフシステムによる応答生成
4. 必要に応じたツール（PDF検索、Web検索）の利用
5. 応答の整形とユーザーへの返送

## 4. セキュリティ機能

- セッション管理によるユーザー分離
- 環境変数による機密情報（APIキー）の管理
- セッションキーによる暗号化

## 5. 拡張性

システムは以下の点で拡張可能な設計となっています：
- 新規ツールの追加
- 異なる言語モデルの利用
- カスタムシステムプロンプトの設定
- 追加のPDFドキュメントの登録

## 6. 初期設定

### 6.1 デフォルト値
- ボット名: ChatBot
- 説明: 汎用的なチャットボット
- システムプロンプト: "あなたは親切で丁寧なアシスタントです。ユーザーの質問に対して正確で分かりやすい回答を提供してください。"

### 6.2 必要な環境変数
- OPENAI_API_KEY
- API_KEY

## 7. システム要件

### 7.1 必要なライブラリ
- langchain関連ライブラリ
- tiktoken
- dotenv
- Flask
- その他必要なPythonパッケージ

### 7.2 ファイル構造
- /templates: HTMLテンプレート
- /static: CSS、JavaScriptファイル
- /data/pdf: 検索対象のPDFファイル
- /chroma_db: ベクトルデータベース保存先

## 8. 制限事項

- PDFファイルは事前に指定されたディレクトリに配置する必要があります
- 環境変数の適切な設定が必要です
- メモリ使用量は利用状況に応じて増加する可能性があります
